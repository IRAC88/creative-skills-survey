<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Creative Skills Survey</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f2f5;
            --shadow-light: #ffffff;
            --shadow-dark: #d1d9e6;
            --accent-soft: #a29bfe;
            --text-main: #2d3436;
            --text-grey: #636e72;
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --pill-active-bg: #e0e5ec;
            --pill-active-shadow-inner: inset 4px 4px 8px #bec8d4, inset -4px -4px 8px #ffffff;
            --pill-shadow-out: 6px 6px 12px #d1d9e6, -6px -6px 12px #ffffff;
            --danger: #ff7675;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
        }

        #app {
            width: 100%;
            height: 100%;
            max-width: 450px;
            /* Standard mobile width */
            background: var(--bg-gradient);
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 40px 24px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            animation: fadeIn 0.4s ease-out;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 24px;
            color: var(--text-main);
        }

        p.subtitle {
            font-size: 16px;
            color: var(--text-grey);
            margin-bottom: 32px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 40px;
        }

        .pill-btn {
            background: var(--bg-color);
            border: none;
            border-radius: 30px;
            padding: 18px 24px;
            font-size: 17px;
            font-weight: 600;
            color: var(--text-main);
            text-align: left;
            cursor: pointer;
            box-shadow: var(--pill-shadow-out);
            transition: all 0.2s ease;
            position: relative;
            outline: none;
        }

        .pill-btn:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
        }

        .pill-btn:active,
        .pill-btn.selected {
            box-shadow: var(--pill-active-shadow-inner);
            transform: scale(0.98);
            color: var(--accent-soft);
        }

        .next-btn,
        .submit-btn {
            margin-top: auto;
            background: var(--bg-color);
            border: none;
            border-radius: 30px;
            padding: 20px;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-main);
            box-shadow: var(--pill-shadow-out);
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .next-btn:active {
            box-shadow: var(--pill-active-shadow-inner);
        }

        .multi-hint {
            font-size: 13px;
            color: var(--text-grey);
            margin-top: -16px;
            margin-bottom: 24px;
            font-style: italic;
        }

        /* Rating System */
        .rating-card {
            background: var(--bg-color);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--pill-shadow-out);
        }

        .rating-label {
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
        }

        .stars {
            display: flex;
            justify-content: space-around;
        }

        .star {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg-color);
            box-shadow: var(--pill-shadow-out);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }

        .star.selected {
            box-shadow: var(--pill-active-shadow-inner);
            color: var(--accent-soft);
        }

        /* Input Styles */
        input[type="text"],
        input[type="number"],
        select {
            background: var(--bg-color);
            border: none;
            border-radius: 20px;
            padding: 18px;
            box-shadow: var(--pill-active-shadow-inner);
            font-family: 'Outfit', sans-serif;
            font-size: 16px;
            width: 100%;
            margin-bottom: 20px;
            outline: none;
        }

        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 4px;
            background: var(--accent-soft);
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Dashboard Styles */
        .dashboard-screen {
            display: none;
            padding: 20px;
            background: var(--bg-gradient);
            height: 100%;
            overflow-y: auto;
        }

        .dashboard-screen.active {
            display: flex;
            flex-direction: column;
        }

        .record-card {
            background: var(--bg-color);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 4px 4px 8px #d1d9e6, -4px -4px 8px #ffffff;
            font-size: 14px;
        }

        .share-container {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .share-btn {
            flex: 1;
            padding: 15px;
            border-radius: 20px;
            border: none;
            background: var(--bg-color);
            box-shadow: var(--pill-shadow-out);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
        }

        .admin-trigger {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            opacity: 0.1;
            /* Hidden but clickable */
            cursor: pointer;
            z-index: 100;
        }

        .clear-btn {
            background: var(--bg-color);
            color: var(--danger);
            border: none;
            border-radius: 20px;
            padding: 10px;
            margin-top: 20px;
            box-shadow: var(--pill-shadow-out);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="progress-bar" id="progressBar"></div>

        <!-- Secret Dashboard Trigger (Top Right) -->
        <div class="admin-trigger" onclick="toggleDashboard()"></div>

        <!-- Intro Screen -->
        <div class="screen active" id="intro">
            <h1 style="margin-top: 60px;">Help us build a creative digital skills program!</h1>
            <p class="subtitle">Anonymous & fast. Your voice matters in shaping the future of digital education.</p>

            <button class="next-btn" onclick="nextScreen('q1')">Get Started</button>

            <div class="share-container">
                <button class="share-btn" onclick="shareSurvey('whatsapp')">
                    <span>ðŸŸ¢</span> WhatsApp
                </button>
                <button class="share-btn" onclick="shareSurvey('link')">
                    <span>ðŸ”—</span> Copy Link
                </button>
            </div>
        </div>

        <!-- Q1 -->
        <div class="screen" id="q1">
            <h1>What device do you use most for the internet?</h1>
            <div class="options-container">
                <button class="pill-btn" onclick="saveSelect('q1', 'My Smartphone')">My Smartphone</button>
                <button class="pill-btn" onclick="saveSelect('q1', 'Shared Family Smartphone')">Shared Family
                    Smartphone</button>
                <button class="pill-btn" onclick="saveSelect('q1', 'Home Computer')">Home Computer</button>
                <button class="pill-btn" onclick="saveSelect('q1', 'Public Laptop')">Public Laptop</button>
                <button class="pill-btn" onclick="saveSelect('q1', 'No Regular Access')">No Regular Access</button>
            </div>
        </div>

        <!-- Q2 -->
        <div class="screen" id="q2">
            <h1>How is your internet connection?</h1>
            <div class="options-container">
                <button class="pill-btn" onclick="saveSelect('q2', 'Fast/Reliable')">Fast/Reliable</button>
                <button class="pill-btn" onclick="saveSelect('q2', 'Data is Expensive')">Data is Expensive</button>
                <button class="pill-btn" onclick="saveSelect('q2', 'Slow/Unreliable')">Slow/Unreliable</button>
                <button class="pill-btn" onclick="saveSelect('q2', 'Offline Only')">Offline Only</button>
            </div>
        </div>

        <!-- Q3 -->
        <div class="screen" id="q3">
            <h1>Why do you create videos?</h1>
            <p class="multi-hint">Select up to 3 options</p>
            <div class="options-container" id="q3-options">
                <button class="pill-btn" onclick="toggleMulti('q3', 'Expressing Opinions')">Expressing Opinions</button>
                <button class="pill-btn" onclick="toggleMulti('q3', 'Social Issues')">Social Issues</button>
                <button class="pill-btn" onclick="toggleMulti('q3', 'Debating')">Debating</button>
                <button class="pill-btn" onclick="toggleMulti('q3', 'Sharing Personal Experience')">Sharing Personal
                    Experience</button>
                <button class="pill-btn" onclick="toggleMulti('q3', 'Just for Fun/Creativity')">Just for Fun</button>
                <button class="pill-btn" onclick="toggleMulti('q3', 'Peer Pressure')">Peer Pressure</button>
            </div>
            <button class="next-btn" onclick="nextScreen('q4')">Next</button>
        </div>

        <!-- Q4 -->
        <div class="screen" id="q4">
            <h1>Have videos ever changed your opinion?</h1>
            <div class="options-container">
                <button class="pill-btn" onclick="saveSelect('q4', 'Totally (FYP challenges me)')">Totally (FYP
                    challenges me)</button>
                <button class="pill-btn" onclick="saveSelect('q4', 'Sometimes (If I trust creator)')">Sometimes (If I
                    trust creator)</button>
                <button class="pill-btn" onclick="saveSelect('q4', 'Not really (I watch to relax)')">Not really (I watch
                    to relax)</button>
                <button class="pill-btn" onclick="saveSelect('q4', 'No way (Need receipts)')">No way (Need
                    receipts)</button>
            </div>
        </div>

        <!-- Q5 -->
        <div class="screen" id="q5">
            <h1>Where do you learn new skills?</h1>
            <div class="options-container" id="q5-options">
                <button class="pill-btn" onclick="toggleMulti('q5', 'Social Media (YouTube/TikTok)')">Social
                    Media</button>
                <button class="pill-btn" onclick="toggleMulti('q5', 'Formal School')">Formal School</button>
                <button class="pill-btn" onclick="toggleMulti('q5', 'Online Courses')">Online Courses</button>
                <button class="pill-btn" onclick="toggleMulti('q5', 'Friends/Family')">Friends/Family</button>
                <button class="pill-btn" onclick="toggleMulti('q5', 'I don\'t know where to start')">Not sure where to
                    start</button>
            </div>
            <button class="next-btn" onclick="nextScreen('q6')">Next</button>
        </div>

        <!-- Q6 -->
        <div class="screen" id="q6">
            <h1>Why do you want digital skills?</h1>
            <p class="multi-hint">Select up to 3 options</p>
            <div class="options-container" id="q6-options">
                <button class="pill-btn" onclick="toggleMulti('q6', 'Career/Job')">Career/Job</button>
                <button class="pill-btn" onclick="toggleMulti('q6', 'Entrepreneurship')">Entrepreneurship</button>
                <button class="pill-btn" onclick="toggleMulti('q6', 'Solve Community Problems')">Community
                    Problems</button>
                <button class="pill-btn" onclick="toggleMulti('q6', 'Hobby/Fun')">Hobby/Fun</button>
                <button class="pill-btn" onclick="toggleMulti('q6', 'Schoolwork')">Schoolwork</button>
                <button class="pill-btn" onclick="toggleMulti('q6', 'Culture/History')">Culture/History</button>
            </div>
            <button class="next-btn" onclick="nextScreen('q7')">Next</button>
        </div>

        <!-- Q7 -->
        <div class="screen" id="q7">
            <h1>How do you engage with serious content?</h1>
            <div class="options-container">
                <button class="pill-btn" onclick="saveSelect('q7', 'Mobile Games')">Mobile Games</button>
                <button class="pill-btn" onclick="saveSelect('q7', 'Short Videos')">Short Videos</button>
                <button class="pill-btn" onclick="saveSelect('q7', 'Long Docs')">Long Docs</button>
                <button class="pill-btn" onclick="saveSelect('q7', 'Reading Articles')">Reading Articles</button>
                <button class="pill-btn" onclick="saveSelect('q7', 'Not Interested')">Not Interested</button>
            </div>
        </div>

        <!-- Q8 - Rating -->
        <div class="screen" id="q8">
            <h1>Rate your interest in:</h1>
            <div id="q8-ratings">
                <!-- Dynamically generated -->
            </div>
            <button class="next-btn" onclick="nextScreen('q9')">Next</button>
        </div>

        <!-- Q9 - Rating -->
        <div class="screen" id="q9">
            <h1>Rate importance of:</h1>
            <div id="q9-ratings">
                <!-- Dynamically generated -->
            </div>
            <button class="next-btn" onclick="nextScreen('q10')">Next</button>
        </div>

        <!-- Q10 - Text -->
        <div class="screen" id="q10">
            <h1>Biggest challenge facing your community?</h1>
            <textarea id="q10-text"
                style="background: var(--bg-color); border: none; border-radius: 20px; padding: 18px; box-shadow: var(--pill-active-shadow-inner); font-family: inherit; font-size: 16px; width: 100%; height: 150px; outline: none; margin-bottom: 20px; resize: none;"
                placeholder="Type your answer here..."></textarea>
            <button class="next-btn" onclick="saveText('q10', 'q11')">Next</button>
        </div>

        <!-- Q11 - Multi -->
        <div class="screen" id="q11">
            <h1>How do you use AI (ChatGPT/Gemini)?</h1>
            <div class="options-container" id="q11-options">
                <button class="pill-btn" onclick="toggleMulti('q11', 'School/Work')">School/Work</button>
                <button class="pill-btn" onclick="toggleMulti('q11', 'Fun/Art')">Fun/Art</button>
                <button class="pill-btn" onclick="toggleMulti('q11', 'New Ideas')">New Ideas</button>
                <button class="pill-btn" onclick="toggleMulti('q11', 'Tried but don\'t use')">Tried it</button>
                <button class="pill-btn" onclick="toggleMulti('q11', 'Never used')">Never used</button>
                <button class="pill-btn" onclick="toggleMulti('q11', 'Don\'t know what it is')">What is AI?</button>
            </div>
            <button class="next-btn" onclick="nextScreen('q12')">Next</button>
        </div>

        <!-- Q12 - Rating -->
        <div class="screen" id="q12">
            <h1>Interest in learning AI skills:</h1>
            <div id="q12-ratings">
                <!-- Dynamically generated -->
            </div>
            <button class="next-btn" onclick="nextScreen('demographics')">Next</button>
        </div>

        <!-- Demographics -->
        <div class="screen" id="demographics">
            <h1>About You</h1>
            <input type="text" id="name" placeholder="Name (Optional)">
            <input type="number" id="age" placeholder="Age">
            <select id="gender">
                <option value="" disabled selected>Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-Binary">Non-Binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select>
            <input type="text" id="country" placeholder="Country">
            <button class="submit-btn" onclick="submitSurvey()">Submit & Download CSV</button>
        </div>

        <!-- End Screen -->
        <div class="screen" id="end">
            <h1 style="margin-top: 60px; text-align: center;">Thank You!</h1>
            <p class="subtitle" style="text-align: center;">Your responses have been saved.</p>
            <div style="display: flex; justify-content: center; margin-top: 20px;">
                <div
                    style="width: 80px; height: 80px; border-radius: 50%; background: var(--bg-color); box-shadow: var(--pill-shadow-out); display: flex; justify-content: center; align-items: center; font-size: 30px;">
                    âœ…</div>
            </div>

            <div class="share-container" style="margin-top: 40px;">
                <button class="share-btn" onclick="shareSurvey('whatsapp')">
                    <span>ðŸŸ¢</span> Share to Friends
                </button>
            </div>

            <button class="pill-btn" style="margin-top: 20px; text-align: center;" onclick="location.reload()">Take
                Survey Again</button>
        </div>

        <!-- Facilitator Dashboard -->
        <div class="screen" id="dashboard">
            <h1>Facilitator Dashboard</h1>
            <p class="subtitle">Viewing all collected responses on this device.</p>

            <div id="records-list" style="flex: 1; overflow-y: auto;">
                <!-- Records list -->
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="next-btn" style="flex: 2" onclick="downloadAllCSV()">Download Excel (CSV)</button>
                <button class="next-btn" style="flex: 1; background: #fff;" onclick="nextScreen('intro')">Back</button>
            </div>
            <button class="clear-btn" onclick="clearData()">Clear All Records</button>
        </div>
    </div>

    <script>
        const surveyData = {};
        const screens = ['intro', 'q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'demographics', 'end'];
        let currentScreenIdx = 0;

        const ratingQuestions = {
            'q8': ['Storytelling', 'Video Editing', 'Graphic Design', 'Game Building', 'App Design'],
            'q9': ['Climate Change', 'Online Safety', 'Entrepreneurship', 'Mental Health', 'Gender Equality'],
            'q12': ['Prompting', 'AI Art', 'AI Coding', 'AI Ethics/Safety']
        };

        function initRatings() {
            Object.keys(ratingQuestions).forEach(qId => {
                const container = document.getElementById(`${qId}-ratings`);
                ratingQuestions[qId].forEach(trait => {
                    const card = document.createElement('div');
                    card.className = 'rating-card';
                    card.innerHTML = `
                        <span class="rating-label">${trait}</span>
                        <div class="stars" id="${qId}-${trait.replace(/\s+/g, '')}">
                            ${[1, 2, 3, 4, 5].map(n => `<div class="star" onclick="setRating('${qId}', '${trait}', ${n}, this)">${n}</div>`).join('')}
                        </div>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function setRating(qId, trait, value, el) {
            if (!surveyData[qId]) surveyData[qId] = {};
            surveyData[qId][trait] = value;

            // UI update
            const parent = el.parentElement;
            parent.querySelectorAll('.star').forEach(s => s.classList.remove('selected'));
            el.classList.add('selected');
        }

        function saveSelect(qId, value) {
            surveyData[qId] = value;
            nextScreen(screens[currentScreenIdx + 1]);
        }

        function toggleMulti(qId, value) {
            if (!surveyData[qId]) surveyData[qId] = [];
            const idx = surveyData[qId].indexOf(value);

            const max = (qId === 'q3' || qId === 'q6') ? 3 : 10;

            if (idx > -1) {
                surveyData[qId].splice(idx, 1);
            } else {
                if (surveyData[qId].length < max) {
                    surveyData[qId].push(value);
                } else {
                    alert(`Maximum ${max} options allowed.`);
                    return;
                }
            }

            // UI update
            updateMultiUI(qId);
        }

        function updateMultiUI(qId) {
            const container = document.getElementById(`${qId}-options`);
            const buttons = container.querySelectorAll('.pill-btn');
            buttons.forEach(btn => {
                if (surveyData[qId] && surveyData[qId].includes(btn.innerText.replace('Social Media', 'Social Media (YouTube/TikTok)').replace('Not sure where to start', 'I don\'t know where to start'))) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            // Specific check for labels that were shortened in UI
            buttons.forEach(btn => {
                const text = btn.innerText;
                let fullValue = text;
                if (text === 'Social Media') fullValue = 'Social Media (YouTube/TikTok)';
                if (text === 'Not sure where to start') fullValue = 'I don\'t know where to start';
                if (text === 'Just for Fun') fullValue = 'Just for Fun/Creativity';
                if (text === 'Community Problems') fullValue = 'Solve Community Problems';

                if (surveyData[qId] && surveyData[qId].includes(fullValue)) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
        }

        function saveText(qId, nextQ) {
            surveyData[qId] = document.getElementById(`${qId}-text`).value;
            nextScreen(nextQ);
        }

        function nextScreen(id) {
            const current = document.querySelector('.screen.active');
            current.classList.remove('active');

            const next = document.getElementById(id);
            next.classList.add('active');

            currentScreenIdx = screens.indexOf(id);
            document.getElementById('progressBar').style.width = `${(currentScreenIdx / (screens.length - 1)) * 100}%`;

            // Scroll to top
            document.getElementById('app').scrollTop = 0;
        }

        function submitSurvey() {
            // Save demographics
            surveyData.timestamp = new Date().toISOString();
            surveyData.name = document.getElementById('name').value || 'Anonymous';
            surveyData.age = document.getElementById('age').value || 'N/A';
            surveyData.gender = document.getElementById('gender').value || 'N/A';
            surveyData.country = document.getElementById('country').value || 'N/A';

            // Save to localStorage
            const history = JSON.parse(localStorage.getItem('survey_history') || '[]');
            history.push({ ...surveyData });
            localStorage.setItem('survey_history', JSON.stringify(history));

            nextScreen('end');
        }

        function shareSurvey(platform) {
            const url = window.location.href;
            const text = "Hey! Help us build a creative digital skills program. Take this quick survey:";

            if (platform === 'whatsapp') {
                window.open(`https://wa.me/?text=${encodeURIComponent(text + " " + url)}`, '_blank');
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert("Survey link copied to clipboard!");
                });
            }
        }

        function toggleDashboard() {
            // Secret access logic: call this to show dashboard
            updateDashboardList();
            nextScreen('dashboard');
        }

        function updateDashboardList() {
            const container = document.getElementById('records-list');
            const history = JSON.parse(localStorage.getItem('survey_history') || '[]');

            if (history.length === 0) {
                container.innerHTML = '<p style="text-align:center; color: var(--text-grey);">No records found yet.</p>';
                return;
            }

            container.innerHTML = history.reverse().map((record, i) => `
                <div class="record-card">
                    <strong>#${history.length - i} - ${record.name} (${record.age})</strong><br>
                    <small>${new Date(record.timestamp).toLocaleString()}</small>
                </div>
            `).join('');
        }

        function downloadAllCSV() {
            const history = JSON.parse(localStorage.getItem('survey_history') || '[]');
            if (history.length === 0) return alert("No data to download.");

            const rows = [];

            // Get all possible keys for headers
            const allKeys = new Set();
            history.forEach(r => Object.keys(r).forEach(k => allKeys.add(k)));
            const headers = Array.from(allKeys);
            rows.push(headers.join(','));

            history.forEach(record => {
                const row = headers.map(header => {
                    let val = record[header] || '';
                    if (typeof val === 'object') val = JSON.stringify(val).replace(/"/g, '""');
                    return `"${val}"`;
                });
                rows.push(row.join(','));
            });

            const csvContent = "data:text/csv;charset=utf-8," + rows.join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "all_survey_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearData() {
            if (confirm("Are you sure you want to delete ALL records? This cannot be undone.")) {
                localStorage.removeItem('survey_history');
                updateDashboardList();
            }
        }

        function initAdminCheck() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                toggleDashboard();
            }
        }

        initRatings();
        initAdminCheck();
    </script>
</body>

</html>